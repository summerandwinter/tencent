# è…¾è®¯è§†é¢‘æ’­æ”¾å™¨Widevineè§£å¯†å™¨

åŸºäºè…¾è®¯è§†é¢‘æ’­æ”¾å™¨superplayer-txv.jsä¸­çš„è§£å¯†æ–¹æ³•ç§»æ¤åˆ°Node.jsç¯å¢ƒçš„å®Œæ•´å®ç°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… å®Œæ•´çš„Widevineè§£å¯†é€»è¾‘å®ç°
- âœ… JSDOMç¯å¢ƒæ¨¡æ‹Ÿæµè§ˆå™¨API
- âœ… è‡ªå®šä¹‰è§£é‡Šå™¨æ”¯æŒ85+æ“ä½œç 
- âœ… è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… æ”¯æŒå¼‚æ­¥è§£å¯†æ“ä½œ
- âœ… å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–

## å®‰è£…ä¾èµ–

```bash
npm install jsdom
```

## åŸºæœ¬ä½¿ç”¨

```javascript
const WidevineDecryptor = require('./widevine_decryptor');

// åˆ›å»ºè§£å¯†å™¨å®ä¾‹
const decryptor = new WidevineDecryptor();

async function decryptVideo() {
    try {
        const result = await decryptor.decrypt({
            anc: "Base64ç¼–ç çš„æŒ‡ä»¤å­—ç¬¦ä¸²"
        });
        
        console.log('è§£å¯†ç»“æœ:', result);
        return result;
        
    } catch (error) {
        console.error('è§£å¯†å¤±è´¥:', error);
        throw error;
    } finally {
        // æ¸…ç†èµ„æº
        decryptor.destroy();
    }
}

// è°ƒç”¨è§£å¯†
decryptVideo();
```

## æµ‹è¯•è¿è¡Œ

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
node widevine_test.js

# æˆ–è€…ä½¿ç”¨npmè„šæœ¬
npm test
```

## è¾“å…¥å‚æ•°æ ¼å¼

è§£å¯†æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯¹è±¡å‚æ•°ï¼š

```javascript
{
    anc: "Base64ç¼–ç çš„æŒ‡ä»¤å­—ç¬¦ä¸²"
}
```

- `anc`: ä»æ’­æ”¾å™¨è·å–çš„Base64ç¼–ç æŒ‡ä»¤å­—ç¬¦ä¸²

## è¿”å›å€¼

è¿”å›ä¸€ä¸ªPromiseï¼Œè§£æåå¾—åˆ°è§£å¯†åçš„æ•°æ®ï¼Œé€šå¸¸æ˜¯è§†é¢‘æµç›¸å…³ä¿¡æ¯ã€‚

## æ ¸å¿ƒæ¶æ„

### 1. è‡ªå®šä¹‰è§£é‡Šå™¨
- æ“ä½œæ•°æ ˆ (Bæ•°ç»„)
- æŒ‡ä»¤æŒ‡é’ˆ (p)
- è·³è½¬æ ˆ (v)
- å¼‚å¸¸æ ˆ (n)

### 2. æ“ä½œç æ”¯æŒ
- åŸºç¡€è¿ç®—: +, -, *, /, ^
- é€»è¾‘è¿ç®—: ===, !==, <, >, <=, >=
- æ§åˆ¶æµ: if/else, è·³è½¬, å‡½æ•°è°ƒç”¨
- å¯¹è±¡æ“ä½œ: å±æ€§è®¿é—®ã€èµ‹å€¼ã€åˆ é™¤
- å¼‚å¸¸å¤„ç†: throw, try/catch

### 3. å…³é”®æ“ä½œç 
- **æ“ä½œç 4**: å“åº”ä¿®æ”¹å™¨è°ƒç”¨ï¼ˆæ ¸å¿ƒè§£å¯†é€»è¾‘ï¼‰
- **æ“ä½œç 8**: è¿”å›æ“ä½œ
- **æ“ä½œç 37**: å¼‚å¸¸æŠ›å‡º
- **æ“ä½œç 25**: æ¡ä»¶è·³è½¬

## é”™è¯¯å¤„ç†

ä»£ç åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

1. **å‚æ•°éªŒè¯**: æ£€æŸ¥ancå‚æ•°çš„æœ‰æ•ˆæ€§
2. **è§£ç é”™è¯¯**: Base64å’ŒVarintè§£ç å¼‚å¸¸å¤„ç†
3. **æ“ä½œç é”™è¯¯**: æœªå®ç°çš„æ“ä½œç å¤„ç†
4. **è¿è¡Œæ—¶é”™è¯¯**: å¼‚å¸¸æ ˆç®¡ç†å’Œé”™è¯¯ä¼ æ’­

## æ—¥å¿—è®°å½•

è¯¦ç»†çš„ä¸­æ–‡æ—¥å¿—å¸®åŠ©è°ƒè¯•ï¼š
- ğŸ”“ è§£å¯†è¿‡ç¨‹å¼€å§‹/å®Œæˆ
- ğŸ“¦ è¾“å…¥å‚æ•°æ˜¾ç¤º
- ğŸ“ æŒ‡ä»¤æ‰§è¡Œè·Ÿè¸ª
- âš ï¸ é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

## æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½**: å»ºè®®ç¼“å­˜è§£å¯†å™¨å®ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»º
2. **å†…å­˜**: å¤§é‡è§£å¯†æ“ä½œååŠæ—¶è°ƒç”¨`destroy()`é‡Šæ”¾èµ„æº
3. **é”™è¯¯å¤„ç†**: ç”Ÿäº§ç¯å¢ƒè¯·æ·»åŠ é€‚å½“çš„é‡è¯•æœºåˆ¶
4. **å®‰å…¨æ€§**: ä¸è¦å°†è§£å¯†å¯†é’¥å’Œç®—æ³•æš´éœ²ç»™å®¢æˆ·ç«¯

## æ‰©å±•è¯´æ˜

### æ·»åŠ æ–°çš„æ“ä½œç 

åœ¨`executeOpcode`æ–¹æ³•ä¸­æ·»åŠ æ–°çš„caseï¼š

```javascript
case XX:
    // æ–°æ“ä½œç å®ç°
    break;
```

### æ‰©å±•è§£å¯†é€»è¾‘

ä¿®æ”¹`responseModifier`å‡½æ•°ä¸­çš„è§£å¯†å¤„ç†ï¼š

```javascript
const responseModifier = async (responseData) => {
    // æ·»åŠ å…·ä½“çš„è§£å¯†ç®—æ³•
    // ä¾‹å¦‚: AESè§£å¯†ã€å¯†é’¥æ´¾ç”Ÿç­‰
    let decryptedData = await this.decryptWithAES(responseData, key);
    return decryptedData;
};
```

## è®¸å¯è¯

MIT License

## ä½œè€…

åŸºäºè…¾è®¯è§†é¢‘æ’­æ”¾å™¨superplayer-txv.jsç§»æ¤ï¼Œé€‚é…Node.jsç¯å¢ƒä½¿ç”¨ã€‚